<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHall 101</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>

    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --bg-color: #f1f5f9;
            --sidebar-bg: rgba(255, 255, 255, 0.95);
            --card-bg: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --border: #e2e8f0;
            --success: #10b981;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --radius: 16px;
        }

        [data-theme="dark"] {
            --bg-color: #000000;
            --sidebar-bg: #121212;
            --card-bg: #121212;
            --text-primary: #f8fafc;
            --text-secondary: #a8a29e;
            --accent: #6366f1;
            --border: #262626;
            --shadow: none;
        }

        body.mode-school .fun-only { display: none !important; }
        body.mode-fun .school-only { display: none !important; }
        
        body.mode-fun {
            --bg-color: #000000;
            --sidebar-bg: #000000;
            --card-bg: #121212;
            --text-primary: #f5f5f5;
            --text-secondary: #a3a3a3;
            --accent: #a855f7;
            --border: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { display: flex; height: 100vh; background-color: var(--bg-color); color: var(--text-primary); transition: background 0.3s; overflow: hidden; }
        
        /* --- UI COMPONENTS --- */
        .btn { padding: 10px 18px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.9rem; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-danger { background: #ef4444; color: white; }
        
        input, textarea, select {
            background: var(--bg-color); border: 1px solid var(--border);
            color: var(--text-primary); padding: 12px; border-radius: 8px;
            outline: none; transition: 0.2s; width: 100%; font-size: 0.95rem;
        }
        input:focus, textarea:focus { border-color: var(--accent); }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 250px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 24px; transition: 0.3s; z-index: 100;
        }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 35px; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        .nav-btn {
            background: none; border: none; color: var(--text-secondary);
            padding: 12px 14px; text-align: left; cursor: pointer; border-radius: 10px;
            margin-bottom: 4px; font-size: 0.95rem; font-weight: 500; display: flex; align-items: center; gap: 12px; transition: 0.2s;
        }
        .nav-btn:hover { background: var(--bg-color); color: var(--text-primary); }
        .nav-btn.active { background: var(--accent); color: white; font-weight: 600; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .section { display: none; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); max-width: 1100px; margin: 0 auto; }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .card {
            background: var(--card-bg); border-radius: var(--radius);
            padding: 24px; margin-bottom: 20px; box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .timer-circle {
            width: 140px; height: 140px; border-radius: 50%;
            border: 6px solid var(--border); border-top-color: var(--accent);
            display: flex; align-items: center; justify-content: center;
            font-size: 2.2rem; font-weight: 700; margin: 0 auto 20px auto;
            background: var(--bg-color); color: var(--text-primary);
        }

        /* --- TO-DO LIST --- */
        .todo-item { background: var(--bg-color); padding: 14px; margin-bottom: 8px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--accent); }
        .todo-item.done { opacity: 0.6; text-decoration: line-through; border-left-color: var(--success); }

        /* --- MATH & EDITOR --- */
        .calc-wrapper { display: flex; gap: 20px; flex-wrap: wrap; }
        .calc-body { width: 280px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .calc-btn { padding: 15px; border-radius: 8px; font-size: 1.1rem; background: var(--bg-color); border: 1px solid var(--border); cursor: pointer; color: var(--text-primary); }
        textarea.notes-area { height: 500px; line-height: 1.6; font-size: 1.05rem; background: var(--card-bg); border: 1px solid var(--border); padding: 30px; resize: vertical; }

        /* --- FULLSCREEN GAMES --- */
        .fullscreen-mode { position: fixed !important; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 99999; padding: 0; margin: 0; display: flex; flex-direction: column; }
        .fullscreen-mode iframe { width: 100%; height: 100%; border: none; }
        iframe { width: 100%; height: 600px; border: none; border-radius: 12px; background: white; }
        
        #login-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 3000; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .login-box { background: var(--card-bg); padding: 40px; border-radius: 24px; text-align: center; width: 380px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); border: 1px solid var(--border); }
        #toast { position: fixed; bottom: 30px; right: 30px; background: var(--text-primary); color: var(--bg-color); padding: 12px 24px; border-radius: 50px; opacity: 0; transition: 0.3s; font-weight: 600; pointer-events: none; z-index: 9999; }
    </style>
</head>
<body class="mode-school" data-theme="light">

    <div id="login-overlay">
        <div class="login-box">
            <h1 style="color: var(--accent); margin-bottom:10px;">StudyHall OS</h1>
            <p style="color: var(--text-secondary); margin-bottom:25px;">Enter your workspace</p>
            <input type="email" id="email" placeholder="Email" style="margin-bottom:10px;">
            <input type="password" id="password" placeholder="Password" style="margin-bottom:20px;">
            <button class="btn btn-primary" onclick="loginUser()" style="width:100%;">Enter Dashboard</button>
            <p id="login-error" style="margin-top:15px; color:#ef4444; font-size:0.9rem;"></p>
        </div>
    </div>

    <div id="toast">Saved automatically</div>

    <nav class="sidebar">
        <div class="logo">üìò StudyHall</div>
        <div style="margin-bottom: 25px; padding: 15px; background: var(--bg-color); border-radius: 12px;">
            <div id="user-display" style="font-weight:700; font-size:0.95rem;">Guest</div>
            <div style="font-size:0.8rem; color:var(--text-secondary); margin-top:2px;">Student Mode</div>
        </div>
        
        <button class="nav-btn school-only active" onclick="showSection('school-home')">üè† Dashboard</button>
        <button class="nav-btn school-only" onclick="showSection('todo')">‚úÖ Tasks</button>
        <button class="nav-btn school-only" onclick="showSection('math')">üìê Math Lab</button>
        <button class="nav-btn school-only" onclick="showSection('science')">üß¨ Science Lab</button>
        <button class="nav-btn school-only" onclick="showSection('ela')">‚úçÔ∏è ELA Writer</button>
        <button class="nav-btn school-only" onclick="showSection('history')">üìú History</button>

        <button class="nav-btn fun-only" onclick="showSection('fun-home')">üéÆ Secret Lounge</button>
        <button class="nav-btn fun-only" onclick="showSection('games')">üïπÔ∏è Arcade</button>
        <button class="nav-btn fun-only" onclick="showSection('chatterbox')">üí¨ ChatterBox</button>

        <div style="margin-top:auto;">
            <button class="nav-btn" onclick="showSection('settings')">‚öôÔ∏è Settings</button>
            <button class="nav-btn" onclick="logoutUser()" style="color:#ef4444;">üö™ Logout</button>
        </div>
    </nav>

    <main class="main-content">
        
        <div id="school-home" class="section active">
            <header style="margin-bottom:35px;">
                <h1 id="greeting">Welcome Back.</h1>
                <p style="color:var(--text-secondary);">Your academic dashboard is ready.</p>
            </header>
            <div class="dashboard-grid">
                <div class="card" style="text-align:center;">
                    <h3>Focus Timer</h3>
                    <div class="timer-circle" id="timer-ui"><span id="timer-display">25:00</span></div>
                    <div style="margin-top:20px;">
                        <button class="btn btn-primary" onclick="toggleTimer()">Start / Pause</button>
                        <button class="btn" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
                <div class="card">
                    <h3>At a Glance</h3>
                    <ul id="mini-todo-list" style="list-style:none; margin-top:15px; padding-left:0;">
                        <li style="color:var(--text-secondary);">No pending tasks.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="todo" class="section">
            <div class="card">
                <h2>Assignment Tracker</h2>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="text" id="newTodo" placeholder="Add a new task...">
                    <button class="btn btn-primary" onclick="addTodo()">Add</button>
                </div>
                <div id="todoList"></div>
            </div>
        </div>

        <div id="math" class="section">
            <h2>Mathematics Laboratory</h2>
            <div class="calc-wrapper">
                <div class="card calc-body">
                    <input type="text" id="calcDisplay" readonly style="margin-bottom:15px; text-align:right; font-size:1.5rem; font-family:monospace; font-weight:600;">
                    <div class="calc-grid">
                        <button class="calc-btn" onclick="calc('sin(')">sin</button>
                        <button class="calc-btn" onclick="calc('cos(')">cos</button>
                        <button class="calc-btn" onclick="calc('tan(')">tan</button>
                        <button class="calc-btn" onclick="calc('C')" style="background:#fee2e2; color:#ef4444;">AC</button>
                        <button class="calc-btn" onclick="calc('sqrt(')">‚àö</button>
                        <button class="calc-btn" onclick="calc('pow(')">^</button>
                        <button class="calc-btn" onclick="calc('(')">(</button>
                        <button class="calc-btn" onclick="calc(')')">)</button>
                        <button class="calc-btn" onclick="calc('7')">7</button>
                        <button class="calc-btn" onclick="calc('8')">8</button>
                        <button class="calc-btn" onclick="calc('9')">9</button>
                        <button class="calc-btn op" onclick="calc('/')">√∑</button>
                        <button class="calc-btn" onclick="calc('4')">4</button>
                        <button class="calc-btn" onclick="calc('5')">5</button>
                        <button class="calc-btn" onclick="calc('6')">6</button>
                        <button class="calc-btn op" onclick="calc('*')">√ó</button>
                        <button class="calc-btn" onclick="calc('1')">1</button>
                        <button class="calc-btn" onclick="calc('2')">2</button>
                        <button class="calc-btn" onclick="calc('3')">3</button>
                        <button class="calc-btn op" onclick="calc('-')">-</button>
                        <button class="calc-btn" onclick="calc('0')">0</button>
                        <button class="calc-btn" onclick="calc('.')">.</button>
                        <button class="calc-btn" onclick="calc('PI')">œÄ</button>
                        <button class="calc-btn op" onclick="calc('=')">=</button>
                    </div>
                </div>
                <div class="card" style="flex:1;">
                    <h3>Notes & Formulas</h3>
                    <textarea id="note-math" class="notes-area" oninput="saveData('math')" placeholder="Write your formulas here..."></textarea>
                </div>
            </div>
        </div>

        <div id="science" class="section">
            <h2>Science Laboratory</h2>
            <div class="card">
                <h3>Lab Report</h3>
                <textarea id="note-science" class="notes-area" oninput="saveData('science')" placeholder="Draft your lab report here..."></textarea>
            </div>
        </div>

        <div id="ela" class="section">
            <h2>Writing Studio</h2>
            <div class="card">
                <textarea id="note-ela" class="notes-area" oninput="saveData('ela'); countWords('note-ela', 'ela-count')" placeholder="Start your essay..."></textarea>
                <div style="text-align:right; margin-top:8px; font-size:0.85rem; color:var(--text-secondary);" id="ela-count">0 words</div>
            </div>
        </div>

        <div id="history" class="section">
            <h2>History Archives</h2>
            <div class="card">
                <textarea id="note-history" class="notes-area" oninput="saveData('history'); countWords('note-history', 'hist-count')" placeholder="Record historical events..."></textarea>
                <div style="text-align:right; margin-top:8px; font-size:0.85rem; color:var(--text-secondary);" id="hist-count">0 words</div>
            </div>
        </div>

        <div id="fun-home" class="section">
            <h2>Secret Lounge</h2>
            <p style="color:var(--text-secondary);">Welcome to the unlocked zone.</p>
        </div>

        <div id="games" class="section">
            <h2>Arcade</h2>
            <div class="dashboard-grid">
                <div class="card" style="text-align:center;"><h3>Geometry Dash</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGame('geo-dash-code')">Play</button></div>
                <div class="card" style="text-align:center;"><h3>Drive Mad</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGame('drive-mad-code')">Play</button></div>
                <div class="card" style="text-align:center;"><h3>Snake</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGame('snake-code')">Play</button></div>
                <div class="card" style="text-align:center;"><h3>Breakout</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGame('breakout-code')">Play</button></div>
                <div class="card" style="text-align:center;"><h3>Pong</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGame('pong-code')">Play</button></div>
                <div class="card" style="text-align:center;"><h3>2048</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGame('2048-code')">Play</button></div>
            </div>
            <div id="game-container" class="card" style="padding:0; overflow:hidden; margin-top:20px;">
                <button class="btn btn-danger" style="position:absolute; top:10px; right:10px; z-index:100; display:none;" id="exit-game-fs" onclick="exitFullGame()">Exit Fullscreen</button>
                <iframe id="game-frame" src=""></iframe>
            </div>
        </div>

        <div id="chatterbox" class="section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2>ChatterBox</h2>
                <button class="btn" onclick="toggleFullscreenEl('chatterbox')">‚õ∂ Fullscreen</button>
            </div>
            <iframe src="https://whatever-works123.github.io/Chatter-Box/" style="height:500px;"></iframe>
        </div>

        <div id="settings" class="section">
            <h2>System Settings</h2>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>üîí Stealth Mode</h3>
                    <p style="color:var(--text-secondary); margin-bottom:15px;">Instantly switch between School and Secret modes.</p>
                    <button class="btn btn-primary" onclick="toggleMode()">Switch Mode</button>
                    <p style="font-size:0.8rem; margin-top:10px; color:var(--text-secondary);">Shortcut: Press <strong>ESC</strong> key</p>
                </div>
                <div class="card">
                    <h3>üé® Appearance</h3>
                    <p style="color:var(--text-secondary); margin-bottom:15px;">Switch between Light and Dark interface.</p>
                    <button class="btn" onclick="toggleTheme()">Toggle Theme</button>
                </div>
            </div>
        </div>
    </main>

    <textarea id="drive-mad-code" style="display:none;"><!DOCTYPE html><html lang="en"><head><base href="https://cdn.jsdelivr.net/gh/genizy/dmad-poki@49b5ab6b987f5f3be58f9dae59c92e8fc1aab9b0/"><script>window.assgdd={"ancestorOrigins":{"0":"https://games.poki.com","1":"https://poki.com"},"href":"https://f9564e4e-ef25-4e4b-ba67-cb11a1576bbd.poki-gdn.com/cc1bc57a-e355-4696-97c2-097bf6188606/index.html?cloudsavegames=y"}</script><meta charset="utf-8"><title>Drive Mad</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="stylesheet" href="webapp/fancade.css"><script src="poki-sdk.js"></script></head><body id="body"><div id="canvas_border" class="emscripten_border"><div id="play_content" class="middle center"><div class="edge"><div class="box"><div class="black"><img src="webapp/cover.jpg" class="cover"><p class="title">Drive Mad</p></div></div></div><div id="progress_or_play"><progress id="progress" class="loading" value="0" max="100"></progress></div></div><canvas class="emscripten" id="canvas" tabindex=-1></canvas></div><script type="text/javascript" src="webapp/source_min.js"></script><script type="text/javascript" src="webapp/index.js"></script></body></html></textarea>
    <textarea id="snake-code" style="display:none;"><!DOCTYPE html><html><body style="margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;font-family:monospace;"><div style="position:absolute;top:10px;">Score: <span id="score">0</span></div><canvas id="c" width="400" height="400" style="border:1px solid #333"></canvas><script>c=document.getElementById('c');x=c.getContext('2d');S=20;p=[{x:10,y:10}];a={x:15,y:15};v={x:0,y:0};sc=0;setInterval(()=>{p.forEach(e=>{x.fillStyle='#000';x.fillRect(e.x*S,e.y*S,S-2,S-2)});p=[{x:p[0].x+v.x,y:p[0].y+v.y},...p.slice(0,sc+1)];if(p[0].x==a.x&&p[0].y==a.y){sc++;document.getElementById('score').innerText=sc;a={x:Math.floor(Math.random()*20),y:Math.floor(Math.random()*20)}}if(p[0].x<0||p[0].x>19||p[0].y<0||p[0].y>19)location.reload();x.fillStyle='#f00';x.fillRect(a.x*S,a.y*S,S-2,S-2);x.fillStyle='#0f0';p.forEach(e=>x.fillRect(e.x*S,e.y*S,S-2,S-2))},100);document.onkeydown=e=>{k=e.keyCode;v={x:k==37?-1:k==39?1:0,y:k==38?-1:k==40?1:0}}</script></body></html></textarea>
    <textarea id="geo-dash-code" style="display:none;"><!DOCTYPE html><html lang="en-US"><head><base href="https://rawcdn.githack.com/genizy/google-class/main/gdlite/"><title>Geometry Dash</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="themes/geometrydashlite.io/rs/css/home.css?v=1"></head><body style="margin:0;overflow:hidden;background:#000;"><div id="gameContainer" style="width:100vw;height:100vh;"></div><script src="Build/UnityLoader.js"></script><script>var gameInstance=UnityLoader.instantiate("gameContainer","Build/GeometryDashLite.json");</script></body></html></textarea>
    <textarea id="breakout-code" style="display:none;"><!DOCTYPE html><html><body style="margin:0;background:#000;display:flex;justify-content:center;align-items:center;height:100vh;"><canvas id="c" width="480" height="320" style="background:#eee;border:2px solid #555"></canvas><script>var c=document.getElementById("c"),ctx=c.getContext("2d");var x=c.width/2,y=c.height-30,dx=2,dy=-2,ballRadius=10,paddleHeight=10,paddleWidth=75,paddleX=(c.width-paddleWidth)/2,rightPressed=false,leftPressed=false,brickRowCount=3,brickColumnCount=5,brickWidth=75,brickHeight=20,brickPadding=10,brickOffsetTop=30,brickOffsetLeft=30,bricks=[];for(var cCol=0;cCol<brickColumnCount;cCol++){bricks[cCol]=[];for(var r=0;r<brickRowCount;r++){bricks[cCol][r]={x:0,y:0,status:1}}}document.addEventListener("keydown",keyDownHandler,false);document.addEventListener("keyup",keyUpHandler,false);function keyDownHandler(e){if(e.key=="Right"||e.key=="ArrowRight"){rightPressed=true}else if(e.key=="Left"||e.key=="ArrowLeft"){leftPressed=true}}function keyUpHandler(e){if(e.key=="Right"||e.key=="ArrowRight"){rightPressed=false}else if(e.key=="Left"||e.key=="ArrowLeft"){leftPressed=false}}function collisionDetection(){for(var cCol=0;cCol<brickColumnCount;cCol++){for(var r=0;r<brickRowCount;r++){var b=bricks[cCol][r];if(b.status==1){if(x>b.x&&x<b.x+brickWidth&&y>b.y&&y<b.y+brickHeight){dy=-dy;b.status=0}}}}}function drawBall(){ctx.beginPath();ctx.arc(x,y,ballRadius,0,Math.PI*2);ctx.fillStyle="#0095DD";ctx.fill();ctx.closePath()}function drawPaddle(){ctx.beginPath();ctx.rect(paddleX,c.height-paddleHeight,paddleWidth,paddleHeight);ctx.fillStyle="#0095DD";ctx.fill();ctx.closePath()}function drawBricks(){for(var cCol=0;cCol<brickColumnCount;cCol++){for(var r=0;r<brickRowCount;r++){if(bricks[cCol][r].status==1){var brickX=(cCol*(brickWidth+brickPadding))+brickOffsetLeft;var brickY=(r*(brickHeight+brickPadding))+brickOffsetTop;bricks[cCol][r].x=brickX;bricks[cCol][r].y=brickY;ctx.beginPath();ctx.rect(brickX,brickY,brickWidth,brickHeight);ctx.fillStyle="#0095DD";ctx.fill();ctx.closePath()}}}}function draw(){ctx.clearRect(0,0,c.width,c.height);drawBricks();drawBall();drawPaddle();collisionDetection();if(x+dx>c.width-ballRadius||x+dx<ballRadius){dx=-dx}if(y+dy<ballRadius){dy=-dy}else if(y+dy>c.height-ballRadius){if(x>paddleX&&x<paddleX+paddleWidth){dy=-dy}else{document.location.reload()}}if(rightPressed&&paddleX<c.width-paddleWidth){paddleX+=7}else if(leftPressed&&paddleX>0){paddleX-=7}x+=dx;y+=dy;requestAnimationFrame(draw)}draw();</script></body></html></textarea>
    <textarea id="pong-code" style="display:none;"><!DOCTYPE html><html><body style="margin:0;background:black;display:flex;justify-content:center;align-items:center;height:100vh;"><canvas id="gameCanvas" width="600" height="400"></canvas><script>var canvas=document.getElementById('gameCanvas');var canvasContext=canvas.getContext('2d');var ballX=50;var ballY=50;var ballSpeedX=10;var ballSpeedY=4;var paddle1Y=250;var paddle2Y=250;var playerScore=0;var computerScore=0;const PADDLE_HEIGHT=100;const PADDLE_THICKNESS=10;function calculateMousePos(evt){var rect=canvas.getBoundingClientRect();var root=document.documentElement;var mouseX=evt.clientX-rect.left-root.scrollLeft;var mouseY=evt.clientY-rect.top-root.scrollTop;return{x:mouseX,y:mouseY}}window.onload=function(){var framesPerSecond=30;setInterval(function(){moveEverything();drawEverything()},1000/framesPerSecond);canvas.addEventListener('mousemove',function(evt){var mousePos=calculateMousePos(evt);paddle1Y=mousePos.y-(PADDLE_HEIGHT/2)})};function ballReset(){if(playerScore>=3||computerScore>=3){playerScore=0;computerScore=0}ballSpeedX=-ballSpeedX;ballX=canvas.width/2;ballY=canvas.height/2}function computerMovement(){var paddle2YCenter=paddle2Y+(PADDLE_HEIGHT/2);if(paddle2YCenter<ballY-35){paddle2Y+=6}else if(paddle2YCenter>ballY+35){paddle2Y-=6}}function moveEverything(){computerMovement();ballX+=ballSpeedX;ballY+=ballSpeedY;if(ballX<0){if(ballY>paddle1Y&&ballY<paddle1Y+PADDLE_HEIGHT){ballSpeedX=-ballSpeedX;var deltaY=ballY-(paddle1Y+PADDLE_HEIGHT/2);ballSpeedY=deltaY*0.35}else{computerScore++;ballReset()}}if(ballX>canvas.width){if(ballY>paddle2Y&&ballY<paddle2Y+PADDLE_HEIGHT){ballSpeedX=-ballSpeedX;var deltaY=ballY-(paddle2Y+PADDLE_HEIGHT/2);ballSpeedY=deltaY*0.35}else{playerScore++;ballReset()}}if(ballY<0){ballSpeedY=-ballSpeedY}if(ballY>canvas.height){ballSpeedY=-ballSpeedY}}function drawEverything(){canvasContext.fillStyle='black';canvasContext.fillRect(0,0,canvas.width,canvas.height);canvasContext.fillStyle='white';canvasContext.fillRect(0,paddle1Y,PADDLE_THICKNESS,PADDLE_HEIGHT);canvasContext.fillRect(canvas.width-PADDLE_THICKNESS,paddle2Y,PADDLE_THICKNESS,PADDLE_HEIGHT);canvasContext.beginPath();canvasContext.arc(ballX,ballY,10,0,Math.PI*2,true);canvasContext.fill();canvasContext.fillText(playerScore,100,100);canvasContext.fillText(computerScore,canvas.width-100,100)}</script></body></html></textarea>
    <textarea id="2048-code" style="display:none;">
<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üî¢</text></svg>">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <meta name="keywords" content="2048 game, 2048 online, puzzle game, classic game, JavaScript game, HTML game">
  <meta name="description" content="2048 is a classic puzzle game where you combine numbers to create higher ones. Play the classic game and challenge your brain with this HTML and JavaScript game!">
  <title>2048 Game</title>
  <style>

      body {
          font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
          background-color: #f8f8f8;
          overscroll-behavior: contain;
      }

      .title {
          font-size: 68px;
          font-weight: bold;
          color: #333;
          text-align: center;
          text-shadow: 2px 2px #eee;
          margin-top: 50px;
      }

      #game-container {
          width: 400px;
          height: 400px;
          margin: 0 auto;
          display: flex;
          flex-wrap: wrap;
          background-color: #bbada0;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
          border-radius: 5px;
          overflow: hidden;
      }

      .grid-item {
          width: 90px;
          height: 90px;
          margin: 5px;
          background-color: #ccc0b3;
          border-radius: 5px;
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 36px;
          color: #776e65;
          box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
          transition: background-color 0.2s, transform 0.2s;
      }

      .grid-item-2 {
          background-color: #eee4da;
      }

      .grid-item-4 {
          background-color: #ede0c8;
      }

      .grid-item-8 {
          background-color: #f2b179;
      }

      .grid-item-16 {
          background-color: #f59563;
      }

      .grid-item-32 {
          background-color: #f67c5f;
      }

      .grid-item-64 {
          background-color: #f65e3b;
      }

      .grid-item-128 {
          background-color: #edcf72;
          color: #776e65;
      }

      .grid-item-256 {
          background-color: #edcc61;
          color: #776e65;
      }

      .grid-item-512 {
          background-color: #edc850;
          color: #776e65;
      }

      .grid-item-1024 {
          background-color: #edc53f;
          color: #776e65;
      }

      .grid-item-2048 {
          background-color: #edc22e;
          color: #776e65;
      }

      .grid-item-new {
          animation: new-tile 0.2s forwards;
      }

      .game-over {
          position: absolute;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.8);
          display: flex;
          justify-content: center;
          align-items: center;
          font-size: 36px;
          color: #fff;
          z-index: 9999;
          opacity: 0;
          pointer-events: none;
          transition: opacity 0.2s;
      }

      .game-over.show {
          opacity: 1;
          pointer-events: all;
      }

      .score {
          font-size: 24px;
          color: #776e65;
          text-align: center;
          margin-bottom: 10px;
      }

      .score span {
          font-weight: bold;
          color: #8f7a66;
      }

      .restart-button {
          padding: 10px 20px;
          background-color: #8f7a66;
          color: #fff;
          border-radius: 5px;
          cursor: pointer;
          transition: background-color 0.2s;
      }

      .restart-button:hover {
          background-color: #776e65;
      }

      @keyframes new-tile {
          0% {
              transform: scale(0.7);
          }
          100% {
              transform: scale(1);
          }
      }

      @media (max-width: 480px) {
          #game-container {
              width: 300px;
              height: 300px;
          }

          .grid-item {
              width: 65px;
              height: 65px;
              font-size: 24px;
          }
      }
  </style>
</head>
<body>
<h1 class="title">2048</h1>
<div id="game-container"></div>
<div class="game-over">
  Game Over
  <div class="score">Score: <span id="final-score"></span></div>
  <div class="restart-button" onclick="resetGame()">Restart</div>
</div>
<div class="score">Score: <span id="score">0</span></div>
<script>
  const gameContainer = document.querySelector('#game-container');
  const scoreEl = document.querySelector('#score');
  const gameOverEl = document.querySelector('.game-over');
  const finalScoreEl = document.querySelector('#final-score');
  let grid = [];
  let score = 0;

  function createGrid() {
    for (let i = 0; i < 4; i++) {
      for (let j = 0; j < 4; j++) {
        const gridItem = document.createElement('div');
        gridItem.classList.add('grid-item');
        gridItem.setAttribute('data-row', i);
        gridItem.setAttribute('data-col', j);
        gameContainer.appendChild(gridItem);
        grid.push(gridItem);
      }
    }
  }

  function addNumber() {
    const emptyGrids = grid.filter(gridItem => gridItem.innerHTML === '');
    if (emptyGrids.length === 0) {
      return;
    }
    const randomIndex = Math.floor(Math.random() * emptyGrids.length);
    const randomGrid = emptyGrids[randomIndex];
    const randomNumber = Math.random() < 0.9 ? 2 : 4;
    randomGrid.innerHTML = randomNumber;
    randomGrid.classList.add(`grid-item-${randomNumber}`);
    randomGrid.classList.add('grid-item-new');
  }

  function moveLeft() {
    let hasMoved = false;
    for (let i = 0; i < 4; i++) {
      for (let j = 1; j < 4; j++) {
        const currentGrid = getGrid(i, j);
        if (currentGrid.innerHTML === '') {
          continue;
        }
        let k = j - 1;
        while (k >= 0) {
          const prevGrid = getGrid(i, k);
          if (prevGrid.innerHTML !== '') {
            if (prevGrid.innerHTML === currentGrid.innerHTML) {
              mergeGrids(currentGrid, prevGrid);
              hasMoved = true;
            }
            break;
          }
          k--;
        }
        if (k !== j - 1) {
          moveGrid(currentGrid, getGrid(i, k + 1));
          hasMoved = true;
        }
      }
    }
    return hasMoved;
  }

  function moveRight() {
    let hasMoved = false;
    for (let i = 0; i < 4; i++) {
      for (let j = 2; j >= 0; j--) {
        const currentGrid = getGrid(i, j);
        if (currentGrid.innerHTML === '') {
          continue;
        }
        let k = j + 1;
        while (k <= 3) {
          const prevGrid = getGrid(i, k);
          if (prevGrid.innerHTML !== '') {
            if (prevGrid.innerHTML === currentGrid.innerHTML) {
              mergeGrids(currentGrid, prevGrid);
              hasMoved = true;
            }
            break;
          }
          k++;
        }
        if (k !== j + 1) {
          moveGrid(currentGrid, getGrid(i, k - 1));
          hasMoved = true;
        }
      }
    }
    return hasMoved;
  }

  function moveUp() {
    let hasMoved = false;
    for (let i = 1; i < 4; i++) {
      for (let j = 0; j < 4; j++) {
        const currentGrid = getGrid(i, j);
        if (currentGrid.innerHTML === '') {
          continue;
        }
        let k = i - 1;
        while (k >= 0) {
          const prevGrid = getGrid(k, j);
          if (prevGrid.innerHTML !== '') {
            if (prevGrid.innerHTML === currentGrid.innerHTML) {
              mergeGrids(currentGrid, prevGrid);
              hasMoved = true;
            }
            break;
          }
          k--;
        }
        if (k !== i - 1) {
          moveGrid(currentGrid, getGrid(k + 1, j));
          hasMoved = true;
        }
      }
    }
    return hasMoved;
  }

  function moveDown() {
    let hasMoved = false;
    for (let i = 2; i >= 0; i--) {
      for (let j = 0; j < 4; j++) {
        const currentGrid = getGrid(i, j);
        if (currentGrid.innerHTML === '') {
          continue;
        }
        let k = i + 1;
        while (k <= 3) {
          const prevGrid = getGrid(k, j);
          if (prevGrid.innerHTML !== '') {
            if (prevGrid.innerHTML === currentGrid.innerHTML) {
              mergeGrids(currentGrid, prevGrid);
              hasMoved = true;
            }
            break;
          }
          k++;
        }
        if (k !== i + 1) {
          moveGrid(currentGrid, getGrid(k - 1, j));
          hasMoved = true;
        }
      }
    }
    return hasMoved;
  }

  function moveGrid(current, target) {
    target.innerHTML = current.innerHTML;
    target.className = current.className;
    current.innerHTML = '';
    current.className = 'grid-item';
  }

  function mergeGrids(current, target) {
    const currentValue = parseInt(current.innerHTML);
    const targetValue = parseInt(target.innerHTML);
    target.innerHTML = currentValue + targetValue;
    target.className = `grid-item grid-item-${currentValue + targetValue}`;
    current.innerHTML = '';
    current.className = 'grid-item';
    score += currentValue + targetValue;
    updateScore();
  }

  function getGrid(row, col) {
    return grid.find(gridItem => {
      return gridItem.getAttribute('data-row') == row && gridItem.getAttribute('data-col') == col;
    });
  }

  function updateScore() {
    scoreEl.innerHTML = `${score}`;
  }

  function showGameOver() {
    finalScoreEl.innerHTML = score;
    gameOverEl.classList.remove('hidden');
  }

  function isGameOver() {
    const emptyGrids = grid.filter(gridItem => gridItem.innerHTML === '');
    if (emptyGrids.length > 0) {
      return false;
    }
    for (let i = 0; i < 4; i++) {
      for (let j = 0; j < 4; j++) {
        const currentGrid = getGrid(i, j);
        const rightGrid = getGrid(i, j + 1);
        const bottomGrid = getGrid(i + 1, j);
        if (rightGrid && currentGrid.innerHTML === rightGrid.innerHTML) {
          return false;
        }
        if (bottomGrid && currentGrid.innerHTML === bottomGrid.innerHTML) {
          return false;
        }
      }
    }
    return true;
  }

  function resetGame() {
    grid.forEach(gridItem => {
      gridItem.innerHTML = '';
      gridItem.className = 'grid-item';
    });
    score = 0;
    updateScore();
    gameOverEl.classList.add('hidden');
    addNumber();
    addNumber();
  }

  document.addEventListener('keydown', e => {
    let hasMoved = false;
    if (e.keyCode === 37) {
      hasMoved = moveLeft();
    } else if (e.keyCode === 38) {
      hasMoved = moveUp();
    } else if (e.keyCode === 39) {
      hasMoved = moveRight();
    } else if (e.keyCode === 40) {
      hasMoved = moveDown();
    }
    if (hasMoved) {
      addNumber();
      if (isGameOver()) {
        showGameOver();
      }
    }
  });

  // Swipe controls
  let xDown = null;
  let yDown = null;

  document.addEventListener('touchstart', e => {
    const firstTouch = e.touches[0];
    xDown = firstTouch.clientX;
    yDown = firstTouch.clientY;
  });

  document.addEventListener('touchmove', e => {
    if (!xDown || !yDown) {
      return;
    }
    const xUp = e.touches[0].clientX;
    const yUp = e.touches[0].clientY;
    const xDiff = xDown - xUp;
    const yDiff = yDown - yUp;
    let hasMoved;
    if (Math.abs(xDiff) > Math.abs(yDiff)) {
      if (xDiff > 0) {
        hasMoved = moveLeft();
      } else {
        hasMoved = moveRight();
      }
    } else {
      if (yDiff > 0) {
        hasMoved = moveUp();
      } else {
        hasMoved = moveDown();
      }
    }

    if (hasMoved) {
      addNumber();
    }
    xDown = null;
    yDown = null;
  });

  createGrid();
  addNumber();
  addNumber();

</script>
</body>
</html>
    </textarea>

    <script>
        // --- 1. FIREBASE CONFIGURATION (UPDATED WITH YOUR KEYS) ---
        const firebaseConfig = {
            apiKey: "AIzaSyABujQAAYKhMxJddtJSvTShWEZ8bqF3kzA",
            authDomain: "chatterbox3000-fb3e2.firebaseapp.com",
            databaseURL: "https://chatterbox3000-fb3e2-default-rtdb.firebaseio.com",
            projectId: "chatterbox3000-fb3e2",
            storageBucket: "chatterbox3000-fb3e2.firebasestorage.app",
            messagingSenderId: "298622361038",
            appId: "1:298622361038:web:c1e46432470dbce92a5f9f"
        };

        // Initialize Firebase
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const auth = firebase.auth();
        const db = firebase.database();
        let currentUser = null;

        // --- 2. AUTHENTICATION LOGIC ---
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                document.getElementById('login-overlay').style.display = 'none';
                document.getElementById('user-display').innerText = user.email.split('@')[0];
                loadUserData();
            } else {
                currentUser = null;
                document.getElementById('login-overlay').style.display = 'flex';
            }
        });

        function loginUser() {
            const e = document.getElementById('email').value;
            const p = document.getElementById('password').value;
            const err = document.getElementById('login-error');
            err.innerText = "Authenticating...";
            auth.signInWithEmailAndPassword(e, p).catch(error => {
                err.innerText = error.message;
            });
        }

        function logoutUser() {
            auth.signOut();
            location.reload();
        }

        // --- 3. NAVIGATION & SAVING ---
        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            if(event && event.target) event.target.classList.add('active');
        }

        function saveData(type) {
            if (!currentUser) return;
            const val = document.getElementById('note-' + type).value;
            db.ref('users/' + currentUser.uid + '/notes/' + type).set(val);
            
            // Show "Saved" toast
            const t = document.getElementById('toast');
            t.style.opacity = '1';
            setTimeout(() => t.style.opacity = '0', 2000);
        }

        function loadUserData() {
            const types = ['math', 'science', 'ela', 'history'];
            types.forEach(t => {
                db.ref('users/' + currentUser.uid + '/notes/' + t).once('value', s => {
                    if(s.val()) document.getElementById('note-' + t).value = s.val();
                });
            });
            // Initialize To-Do List Listener
            initTodoListener();
        }

        // --- 4. CALCULATOR (FIXED) ---
        function calc(val) {
            const disp = document.getElementById('calcDisplay');
            if (val === 'C') {
                disp.value = '';
            } else if (val === '=') {
                try {
                    let expr = disp.value
                        .replace(/sin\(/g, 'Math.sin(')
                        .replace(/cos\(/g, 'Math.cos(')
                        .replace(/tan\(/g, 'Math.tan(')
                        .replace(/sqrt\(/g, 'Math.sqrt(')
                        .replace(/PI/g, 'Math.PI')
                        .replace(/\^/g, '**');
                    
                    let res = eval(expr);
                    disp.value = Number.isInteger(res) ? res : res.toFixed(4).replace(/\.?0+$/, '');
                } catch { disp.value = 'Error'; }
            } else {
                disp.value += (val === 'pow(' ? '^' : val);
            }
        }

        // --- 5. TO-DO LIST ---
        function addTodo() {
            const input = document.getElementById('newTodo');
            const text = input.value.trim();
            if (!text || !currentUser) return;
            db.ref('users/' + currentUser.uid + '/todos').push({ text: text, done: false });
            input.value = '';
        }

        function initTodoListener() {
            if (!currentUser) return;
            const list = document.getElementById('todoList');
            const miniList = document.getElementById('mini-todo-list');

            db.ref('users/' + currentUser.uid + '/todos').on('value', snapshot => {
                list.innerHTML = '';
                miniList.innerHTML = '';
                let count = 0;

                snapshot.forEach(child => {
                    const task = child.val();
                    const key = child.key;
                    
                    const div = document.createElement('div');
                    div.className = `todo-item ${task.done ? 'done' : ''}`;
                    div.innerHTML = `<span>${task.text}</span><div><button class="btn" style="padding:5px 10px; font-size:0.8rem;" onclick="toggleTodo('${key}', ${!task.done})">${task.done ? 'Undo' : 'Done'}</button><button class="btn btn-danger" style="padding:5px 10px; font-size:0.8rem; margin-left:5px;" onclick="deleteTodo('${key}')">X</button></div>`;
                    list.appendChild(div);

                    if (!task.done) {
                        count++;
                        const li = document.createElement('li');
                        li.innerText = '‚Ä¢ ' + task.text;
                        miniList.appendChild(li);
                    }
                });
                if (count === 0) miniList.innerHTML = '<li style="color:var(--text-secondary);">No pending tasks.</li>';
            });
        }

        function toggleTodo(key, status) { db.ref('users/' + currentUser.uid + '/todos/' + key).update({ done: status }); }
        function deleteTodo(key) { db.ref('users/' + currentUser.uid + '/todos/' + key).remove(); }


        // --- 6. GAMES & FULLSCREEN ---
        function loadGame(codeId) {
            const container = document.getElementById('game-container');
            const frame = document.getElementById('game-frame');
            container.classList.add('fullscreen-mode');
            document.getElementById('exit-game-fs').style.display = 'block';
            frame.srcdoc = document.getElementById(codeId).value;
            frame.onload = () => frame.contentWindow.focus();
        }

        function exitFullGame() {
            const c = document.getElementById('game-container');
            c.classList.remove('fullscreen-mode');
            document.getElementById('exit-game-fs').style.display = 'none';
            document.getElementById('game-frame').srcdoc = '';
        }

        function toggleFullscreenEl(id) {
            const el = document.getElementById(id);
            if(el.classList.contains('fullscreen-mode')) {
                 el.classList.remove('fullscreen-mode');
            } else {
                 document.querySelectorAll('.fullscreen-mode').forEach(e => e.classList.remove('fullscreen-mode'));
                 el.classList.add('fullscreen-mode');
            }
        }

        // --- 7. SYSTEM SETTINGS ---
        function toggleTheme() {
            const b = document.body;
            b.dataset.theme = b.dataset.theme === 'light' ? 'dark' : 'light';
        }

        function toggleMode() {
            document.body.classList.toggle('mode-school');
            document.body.classList.toggle('mode-fun');
            if(document.body.classList.contains('mode-school')) showSection('school-home');
            else showSection('fun-home');
        }

        // --- 8. GLOBAL EVENT LISTENERS (ESCAPE KEY FAIL-SAFE) ---
        document.addEventListener('keydown', e => {
            // SAFE CHECK: If typing in a box, IGNORE Escape key
            if (e.target.tagName === 'TEXTAREA' || e.target.tagName === 'INPUT') return;

            if (e.key === "Escape") {
                if (document.querySelector('.fullscreen-mode')) {
                    exitFullGame();
                    document.querySelectorAll('.fullscreen-mode').forEach(el => el.classList.remove('fullscreen-mode'));
                } else if (document.body.classList.contains('mode-fun')) {
                    toggleMode();
                }
            }
        });

        // --- 9. UTILS ---
        function countWords(area, display) {
            const txt = document.getElementById(area).value.trim();
            document.getElementById(display).innerText = txt ? txt.split(/\s+/).length + " words" : "0 words";
        }
        
        let timerInt;
        function toggleTimer() {
            if(timerInt) { clearInterval(timerInt); timerInt = null; }
            else {
                timerInt = setInterval(() => {
                    const el = document.getElementById('timer-display');
                    let [m, s] = el.innerText.split(':').map(Number);
                    if(s===0) { if(m===0) return clearInterval(timerInt); m--; s=59; } else s--;
                    el.innerText = `${m}:${s<10?'0'+s:s}`;
                }, 1000);
            }
        }
        function resetTimer() { clearInterval(timerInt); timerInt=null; document.getElementById('timer-display').innerText="25:00"; }
    </script>
</body>
</html>
