<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StudyHall OS 6.0 (Offline Edition)</title>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* --- CSS VARIABLES --- */
        :root {
            --bg-color: #f1f5f9;
            --sidebar-bg: rgba(255, 255, 255, 0.95);
            --card-bg: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --accent: #2563eb;
            --accent-hover: #1d4ed8;
            --border: #e2e8f0;
            --success: #10b981;
            --danger: #ef4444;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
            --radius: 16px;
            
            /* Day Colors */
            --red-day: #ef4444;
            --green-day: #10b981;
            
            /* Periodic Table Colors */
            --cat-1: #ef4444; --cat-2: #f97316; --cat-3: #eab308; 
            --cat-4: #22c55e; --cat-5: #06b6d4; --cat-6: #3b82f6; 
            --cat-7: #8b5cf6; --cat-8: #d946ef; --cat-9: #f43f5e; --cat-0: #94a3b8;
        }

        [data-theme="dark"] {
            --bg-color: #000000;
            --sidebar-bg: #121212;
            --card-bg: #121212;
            --text-primary: #f8fafc;
            --text-secondary: #a8a29e;
            --accent: #6366f1;
            --border: #262626;
            --shadow: none;
        }

        body.mode-school .fun-only { display: none !important; }
        body.mode-fun .school-only { display: none !important; }
        
        body.mode-fun {
            --bg-color: #000000;
            --sidebar-bg: #000000;
            --card-bg: #121212;
            --text-primary: #f5f5f5;
            --text-secondary: #a3a3a3;
            --accent: #a855f7;
            --border: #333333;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; }
        body { display: flex; height: 100vh; background-color: var(--bg-color); color: var(--text-primary); transition: background 0.3s; overflow: hidden; }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }

        /* --- UI COMPONENTS --- */
        .btn { padding: 10px 18px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.2s; font-size: 0.9rem; }
        .btn-primary { background: var(--accent); color: white; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-danger { background: var(--danger); color: white; }
        
        input, textarea, select {
            background: var(--bg-color); border: 1px solid var(--border);
            color: var(--text-primary); padding: 12px; border-radius: 8px;
            outline: none; transition: 0.2s; width: 100%; font-size: 0.95rem;
        }
        input:focus, textarea:focus { border-color: var(--accent); }

        /* --- SIDEBAR --- */
        .sidebar {
            width: 260px; background-color: var(--sidebar-bg); border-right: 1px solid var(--border);
            display: flex; flex-direction: column; padding: 24px; transition: 0.3s; z-index: 100;
        }
        .logo { font-size: 1.5rem; font-weight: 800; margin-bottom: 25px; color: var(--accent); display: flex; align-items: center; gap: 10px; }
        
        .sidebar-section-title {
            font-size: 0.75rem; text-transform: uppercase; color: var(--text-secondary);
            font-weight: 700; margin: 20px 0 10px 5px; letter-spacing: 0.5px;
        }

        .nav-btn {
            background: none; border: none; color: var(--text-secondary);
            padding: 10px 14px; text-align: left; cursor: pointer; border-radius: 10px;
            margin-bottom: 4px; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 12px; transition: 0.2s; width: 100%;
        }
        .nav-btn:hover { background: var(--bg-color); color: var(--text-primary); }
        .nav-btn.active { background: var(--accent); color: white; font-weight: 600; }
        
        .sched-btn {
            border-left: 3px solid transparent; border-radius: 4px;
            padding: 8px 12px; font-size: 0.85rem; margin-bottom: 2px;
        }
        .sched-btn span { font-weight: 700; margin-right: 8px; opacity: 0.7; width: 20px; display: inline-block; }

        /* --- MAIN CONTENT --- */
        .main-content { flex: 1; padding: 30px; overflow-y: auto; position: relative; }
        .section { display: none; animation: slideUp 0.3s cubic-bezier(0.16, 1, 0.3, 1); max-width: 1100px; margin: 0 auto; }
        .section.active { display: block; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .card {
            background: var(--card-bg); border-radius: var(--radius);
            padding: 24px; margin-bottom: 20px; box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .dashboard-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .timer-circle {
            width: 140px; height: 140px; border-radius: 50%;
            border: 6px solid var(--border); border-top-color: var(--accent);
            display: flex; align-items: center; justify-content: center;
            font-size: 2.2rem; font-weight: 700; margin: 0 auto 20px auto;
            background: var(--bg-color); color: var(--text-primary);
        }
        
        .day-indicator {
            padding: 15px; border-radius: 12px; color: white; font-weight: 700;
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; box-shadow: var(--shadow);
        }
        .day-red { background: linear-gradient(135deg, #ef4444, #b91c1c); }
        .day-green { background: linear-gradient(135deg, #10b981, #047857); }

        .todo-item { background: var(--bg-color); padding: 14px; margin-bottom: 8px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; border-left: 4px solid var(--accent); }
        .todo-item.done { opacity: 0.6; text-decoration: line-through; border-left-color: var(--success); }

        .calc-wrapper { display: flex; gap: 20px; flex-wrap: wrap; }
        .calc-body { width: 280px; }
        .calc-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
        .calc-btn { padding: 15px; border-radius: 8px; font-size: 1.1rem; background: var(--bg-color); border: 1px solid var(--border); cursor: pointer; color: var(--text-primary); }
        textarea.notes-area { height: 500px; line-height: 1.6; font-size: 1.05rem; background: var(--card-bg); border: 1px solid var(--border); padding: 30px; resize: vertical; }

        /* --- PERIODIC TABLE --- */
        .periodic-table { display: grid; grid-template-columns: repeat(18, 1fr); gap: 3px; width: 100%; max-width: 900px; margin: 0 auto; }
        .element { background: var(--bg-color); border: 1px solid var(--border); color: var(--text-primary); aspect-ratio: 5/6; padding: 4px; border-radius: 4px; cursor: pointer; display: flex; flex-direction: column; justify-content: space-between; }
        .element:hover { transform: scale(1.6); z-index: 100; background: var(--card-bg); border-color: var(--accent); box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .num { font-size: 8px; opacity: 0.6; } .sym { font-size: 14px; font-weight: 700; text-align: center; }
        .cat-alkali { border-bottom: 3px solid var(--cat-1); } .cat-alkaline { border-bottom: 3px solid var(--cat-2); }
        .cat-transition { border-bottom: 3px solid var(--cat-3); } .cat-post-transition { border-bottom: 3px solid var(--cat-4); }
        .cat-metalloid { border-bottom: 3px solid var(--cat-5); } .cat-reactive-nonmetal { border-bottom: 3px solid var(--cat-6); }
        .cat-noble-gas { border-bottom: 3px solid var(--cat-7); } .cat-lanthanide { border-bottom: 3px solid var(--cat-8); }
        .cat-actinide { border-bottom: 3px solid var(--cat-9); } .cat-unknown { border-bottom: 3px solid var(--cat-0); }
        #pt-panel { background: var(--bg-color); border: 1px solid var(--border); padding: 15px 25px; border-radius: 12px; margin-bottom: 20px; display: none; align-items: center; justify-content: space-between; }
        #pt-panel.active { display: flex; animation: fadeIn 0.2s; }

        /* --- INSTAGRAM --- */
        .insta-main-wrapper { max-width: 600px; margin: 0 auto; }
        .insta-navbar { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 20px; padding: 10px 20px; display: flex; align-items: center; justify-content: space-between; }
        .insta-nav-icons { display: flex; align-items: center; gap: 15px; }
        .insta-nav-icons i { font-size: 1.4rem; color: var(--text-primary); cursor: pointer; transition: transform 0.2s; }
        .insta-nav-icons i:hover { transform: scale(1.1); }
        .insta-post-card { background: var(--card-bg); border: 1px solid var(--border); border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .insta-post-header { padding: 12px; display: flex; align-items: center; justify-content: space-between; }
        .insta-user-details { display: flex; align-items: center; gap: 10px; }
        .insta-profile-pic { width: 32px; height: 32px; border-radius: 50%; padding: 1.5px; background: linear-gradient(45deg, #f09433, #bc1888); }
        .insta-profile-pic div, .insta-profile-pic img { width: 100%; height: 100%; border-radius: 50%; border: 1.5px solid var(--card-bg); object-fit: cover; }
        .insta-user-details h3 { font-size: 0.9rem; font-weight: 600; margin: 0; color: var(--text-primary); }
        .insta-user-details span { font-size: 0.75rem; color: var(--text-secondary); }
        .insta-post-img { width: 100%; display: block; background: #000; min-height: 200px; object-fit: cover; }
        .insta-post-footer { padding: 12px; }
        .insta-actions { display: flex; justify-content: space-between; margin-bottom: 10px; }
        .insta-action-left { display: flex; gap: 15px; }
        .insta-actions i { font-size: 1.5rem; color: var(--text-primary); cursor: pointer; transition: 0.2s; }
        .insta-actions i:hover { color: var(--accent); }
        .fa-heart.liked { color: #ed4956; animation: pop 0.3s ease; }
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.2); } 100% { transform: scale(1); } }
        .insta-likes { font-weight: 600; font-size: 0.9rem; margin-bottom: 6px; }
        .insta-caption { font-size: 0.9rem; line-height: 1.4; margin-bottom: 6px; }
        .insta-caption b { font-weight: 600; margin-right: 5px; }
        .insta-time { font-size: 0.7rem; color: var(--text-secondary); text-transform: uppercase; margin-bottom: 5px; }

        .fullscreen-mode { position: fixed !important; top: 0; left: 0; width: 100vw; height: 100vh; background: black; z-index: 99999; padding: 0; margin: 0; display: flex; flex-direction: column; border-radius: 0 !important; }
        .fullscreen-mode iframe { width: 100%; height: 100%; border: none; border-radius: 0; }
        iframe { width: 100%; height: 600px; border: none; border-radius: 12px; background: white; }
        
        #login-overlay, #setup-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 3000; display: flex; justify-content: center; align-items: center; backdrop-filter: blur(8px); }
        .login-box { background: var(--card-bg); padding: 40px; border-radius: 24px; text-align: center; width: 380px; box-shadow: 0 25px 50px rgba(0,0,0,0.2); border: 1px solid var(--border); }
        #toast { position: fixed; bottom: 30px; right: 30px; background: var(--text-primary); color: var(--bg-color); padding: 12px 24px; border-radius: 50px; opacity: 0; transition: 0.3s; font-weight: 600; box-shadow: 0 10px 20px rgba(0,0,0,0.15); pointer-events: none; z-index: 9999; }
        
        .schedule-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; text-align: left; }
        .schedule-col h4 { margin-bottom: 10px; color: var(--text-secondary); border-bottom: 2px solid; padding-bottom: 5px; display: inline-block; }
        .red-day h4 { border-color: var(--red-day); color: var(--red-day); }
        .green-day h4 { border-color: var(--green-day); color: var(--green-day); }
        .class-input { margin-bottom: 8px; font-size: 0.9rem; }
    </style>
</head>
<body class="mode-school" data-theme="light">

    <div id="login-overlay">
        <div class="login-box">
            <h1 style="color: var(--accent); margin-bottom:10px;">StudyHall OS</h1>
            <p style="color: var(--text-secondary); margin-bottom:25px;">Offline Workspace</p>
            <input type="text" id="email" placeholder="Username" style="margin-bottom:10px;">
            <input type="password" id="password" placeholder="Password" style="margin-bottom:20px;">
            <div style="display:flex; gap:10px;">
                <button class="btn btn-primary" onclick="loginUser()" style="width:100%;">Log In</button>
                <button class="btn" onclick="registerUser()" style="width:100%; border:1px solid var(--border);">Sign Up</button>
            </div>
            <p id="login-error" style="margin-top:15px; color:#ef4444; font-size:0.9rem; min-height: 20px;"></p>
        </div>
    </div>

    <div id="setup-overlay" style="display:none;">
        <div class="login-box" style="width: 500px; text-align: left;">
            <h2 style="color: var(--accent); margin-bottom:10px; text-align:center;">Setup Schedule</h2>
            <p style="color: var(--text-secondary); margin-bottom:20px; text-align:center;">Please enter your classes for the block schedule.</p>
            <div class="schedule-grid">
                <div class="schedule-col red-day">
                    <h4>üü• Red Day</h4>
                    <input class="class-input" id="setup-r1" placeholder="R1 Class Name">
                    <input class="class-input" id="setup-r2" placeholder="R2 Class Name">
                    <input class="class-input" id="setup-r3" placeholder="R3 Class Name">
                    <input class="class-input" id="setup-r4" placeholder="R4 Class Name">
                </div>
                <div class="schedule-col green-day">
                    <h4>üü© Green Day</h4>
                    <input class="class-input" id="setup-g5" placeholder="G5 Class Name">
                    <input class="class-input" id="setup-g6" placeholder="G6 Class Name">
                    <input class="class-input" id="setup-g7" placeholder="G7 Class Name">
                    <input class="class-input" id="setup-g8" placeholder="G8 Class Name">
                </div>
            </div>
            <button class="btn btn-primary" onclick="saveInitialSetup()" style="width:100%;">Save & Enter OS</button>
        </div>
    </div>

    <div id="toast">Saved automatically</div>

    <nav class="sidebar">
        <div class="logo">üìò StudyHall</div>
        
        <div style="margin-bottom: 15px; padding: 15px; background: var(--bg-color); border-radius: 12px;">
            <div id="user-display" style="font-weight:700; font-size:0.95rem;">Guest</div>
            <div style="font-size:0.8rem; color:var(--text-secondary); margin-top:2px;">Student Mode</div>
        </div>

        <div class="school-only">
            <div class="sidebar-section-title">Today's Classes</div>
            <div id="sidebar-schedule-list" style="margin-bottom: 20px;">
                <div style="font-size:0.8rem; color:var(--text-secondary); padding-left:10px;">Loading...</div>
            </div>

            <div class="sidebar-section-title">Apps & Tools</div>
            <button class="nav-btn active" onclick="showSection('school-home')"><i class="fas fa-home"></i> Dashboard</button>
            <button class="nav-btn" onclick="showSection('todo')"><i class="fas fa-check-square"></i> Tasks</button>
            <button class="nav-btn" onclick="showSection('math')"><i class="fas fa-calculator"></i> Math Lab</button>
            <button class="nav-btn" onclick="showSection('science')"><i class="fas fa-flask"></i> Science Lab</button>
            <button class="nav-btn" onclick="showSection('ela')"><i class="fas fa-pen-nib"></i> ELA Writer</button>
            <button class="nav-btn" onclick="showSection('history')"><i class="fas fa-landmark"></i> History</button>
        </div>

        <div class="fun-only">
            <div class="sidebar-section-title">Secret Menu</div>
            <button class="nav-btn" onclick="showSection('fun-home')">üéÆ Secret Lounge</button>
            <button class="nav-btn" onclick="showSection('games')">üïπÔ∏è Arcade</button>
            <button class="nav-btn" onclick="showSection('social-feed')">üì∏ Social Feed</button>
            <button class="nav-btn" onclick="showSection('chatterbox')">üí¨ ChatterBox</button>
        </div>

        <div style="margin-top:auto;">
            <button class="nav-btn" onclick="showSection('settings')"><i class="fas fa-cog"></i> Settings</button>
            <button class="nav-btn" onclick="logoutUser()" style="color:#ef4444;"><i class="fas fa-sign-out-alt"></i> Logout</button>
        </div>
    </nav>

    <main class="main-content">
        
        <div id="school-home" class="section active">
            <div id="day-banner" class="day-indicator">
                <div>
                    <span style="opacity:0.8; font-size:0.9rem; text-transform:uppercase; letter-spacing:1px;">Today is a</span>
                    <div style="font-size:1.8rem; line-height:1;" id="day-title">Loading...</div>
                </div>
                <div style="font-size:3rem; opacity:0.3;"><i class="far fa-calendar-alt"></i></div>
            </div>

            <div class="dashboard-grid">
                <div class="card" style="text-align:center;">
                    <h3>Focus Timer</h3>
                    <div class="timer-circle" id="timer-ui"><span id="timer-display">25:00</span></div>
                    <div style="margin-top:20px;">
                        <button class="btn btn-primary" onclick="toggleTimer()">Start / Pause</button>
                        <button class="btn" onclick="resetTimer()">Reset</button>
                    </div>
                </div>
                <div class="card">
                    <h3>Assignments</h3>
                    <ul id="mini-todo-list" style="list-style:none; margin-top:15px; padding-left:0;">
                        <li style="color:var(--text-secondary);">No pending tasks.</li>
                    </ul>
                </div>
            </div>
        </div>

        <div id="todo" class="section">
            <div class="card">
                <h2>Assignment Tracker</h2>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <input type="text" id="newTodo" placeholder="Add a new task...">
                    <button class="btn btn-primary" onclick="addTodo()">Add</button>
                </div>
                <div id="todoList"></div>
            </div>
        </div>

        <div id="math" class="section">
            <h2>Mathematics Laboratory</h2>
            <div class="calc-wrapper">
                <div class="card calc-body">
                    <input type="text" id="calcDisplay" readonly style="margin-bottom:15px; text-align:right; font-size:1.5rem; font-family:monospace; font-weight:600;">
                    <div class="calc-grid">
                        <button class="calc-btn" onclick="calc('sin(')">sin</button>
                        <button class="calc-btn" onclick="calc('cos(')">cos</button>
                        <button class="calc-btn" onclick="calc('tan(')">tan</button>
                        <button class="calc-btn" onclick="calc('C')" style="background:#fee2e2; color:#ef4444;">AC</button>
                        <button class="calc-btn" onclick="calc('sqrt(')">‚àö</button>
                        <button class="calc-btn" onclick="calc('pow(')">^</button>
                        <button class="calc-btn" onclick="calc('(')">(</button>
                        <button class="calc-btn" onclick="calc(')')">)</button>
                        <button class="calc-btn" onclick="calc('7')">7</button>
                        <button class="calc-btn" onclick="calc('8')">8</button>
                        <button class="calc-btn" onclick="calc('9')">9</button>
                        <button class="calc-btn op" onclick="calc('/')">√∑</button>
                        <button class="calc-btn" onclick="calc('4')">4</button>
                        <button class="calc-btn" onclick="calc('5')">5</button>
                        <button class="calc-btn" onclick="calc('6')">6</button>
                        <button class="calc-btn op" onclick="calc('*')">√ó</button>
                        <button class="calc-btn" onclick="calc('1')">1</button>
                        <button class="calc-btn" onclick="calc('2')">2</button>
                        <button class="calc-btn" onclick="calc('3')">3</button>
                        <button class="calc-btn op" onclick="calc('-')">-</button>
                        <button class="calc-btn" onclick="calc('0')">0</button>
                        <button class="calc-btn" onclick="calc('.')">.</button>
                        <button class="calc-btn" onclick="calc('PI')">œÄ</button>
                        <button class="calc-btn op" onclick="calc('=')">=</button>
                    </div>
                </div>
                <div class="card" style="flex:1;">
                    <h3>Notes & Formulas</h3>
                    <textarea id="note-math" class="notes-area" oninput="saveData('math')" placeholder="Write your formulas here..."></textarea>
                </div>
            </div>
        </div>

        <div id="science" class="section">
            <h2>Science Laboratory</h2>
            <div class="card">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                    <h3>Periodic Table</h3>
                    <span style="font-size:0.8rem; color:var(--text-secondary);">Interactive</span>
                </div>
                <div id="pt-panel">
                    <div><h2 id="p-sym" style="font-size:2.5rem; margin:0; line-height:1;">H</h2><span id="p-cat">Unknown</span></div>
                    <div style="text-align:right;"><h3 id="p-name" style="margin:0;">Hydrogen</h3><p id="p-data" style="margin:0; font-size:0.9rem;">No. 1 | 1.008u</p></div>
                </div>
                <div class="periodic-table" id="table"></div>
            </div>
            <div class="card">
                <h3>Lab Report</h3>
                <textarea id="note-science" class="notes-area" oninput="saveData('science')" placeholder="Draft your lab report here..."></textarea>
            </div>
        </div>

        <div id="ela" class="section">
            <h2>Writing Studio</h2>
            <div class="card">
                <textarea id="note-ela" class="notes-area" oninput="saveData('ela'); countWords('note-ela', 'ela-count')" placeholder="Start your essay..."></textarea>
                <div style="text-align:right; margin-top:8px; font-size:0.85rem; color:var(--text-secondary);" id="ela-count">0 words</div>
            </div>
        </div>

        <div id="history" class="section">
            <h2>History Archives</h2>
            <div class="card">
                <textarea id="note-history" class="notes-area" oninput="saveData('history'); countWords('note-history', 'hist-count')" placeholder="Record historical events..."></textarea>
                <div style="text-align:right; margin-top:8px; font-size:0.85rem; color:var(--text-secondary);" id="hist-count">0 words</div>
            </div>
        </div>

        <div id="fun-home" class="section">
            <h2>Secret Lounge</h2>
            <p style="color:var(--text-secondary);">Welcome to the unlocked zone.</p>
        </div>

        <div id="social-feed" class="section">
            <div class="insta-main-wrapper">
                <div class="insta-navbar">
                    <div class="logo" style="font-family: 'Inter', sans-serif; font-weight:700; font-size:1.2rem;">
                        StudyHall Social
                    </div>
                    <div class="insta-nav-icons">
                        <i class="fas fa-home" onclick="loadPosts()" title="Refresh Feed"></i>
                        <i class="far fa-plus-square" onclick="document.getElementById('new-post-area').style.display = 'block'" title="New Post"></i>
                        <div class="insta-profile-pic" style="width:28px; height:28px; padding:0;">
                            <div id="nav-user-pic" style="width:100%; height:100%; border-radius:50%; background:#333; color:white; display:flex; justify-content:center; align-items:center; font-size:12px;">U</div>
                        </div>
                    </div>
                </div>
                <div id="new-post-area" class="insta-post-card" style="padding:20px; display:none;">
                    <h3 style="margin-bottom:15px;">New Post</h3>
                    <input type="text" id="post-img-url" placeholder="Image URL (optional)..." style="width:100%; margin-bottom:10px; padding:8px; border:1px solid var(--border); border-radius:4px; background:var(--bg-color); color:var(--text-primary);">
                    <textarea id="post-caption-input" placeholder="What's on your mind?" style="width:100%; height:60px; margin-bottom:10px; padding:8px; border:1px solid var(--border); border-radius:4px; background:var(--bg-color); color:var(--text-primary);"></textarea>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-primary" onclick="createInstaPost()" style="width:100%;">Share</button>
                        <button class="btn" onclick="document.getElementById('new-post-area').style.display='none'" style="width:100%;">Cancel</button>
                    </div>
                </div>
                <div id="feed-container">
                    <p style="text-align:center; padding:20px; color:var(--text-secondary);">Loading feed...</p>
                </div>
            </div>
        </div>

        <div id="games" class="section">
            <h2>Arcade</h2>
            <div class="dashboard-grid">
                <div class="card" style="text-align:center;"><h3>Geometry Dash</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadGeoDash()">Play</button></div>
                <div class="card" style="text-align:center;"><h3>Drive Mad</h3><button class="btn btn-primary" style="margin-top:10px; width:100%;" onclick="loadDriveMad()">Play</button></div>
            </div>
            
            <div id="game-container" class="card" style="padding:0; overflow:hidden; margin-top:20px; position:relative;">
                <button class="btn btn-danger" style="position:absolute; top:10px; right:10px; z-index:100; display:none;" id="exit-game-fs" onclick="exitFullGame()">Exit Fullscreen</button>
                <button class="btn btn-primary" style="position:absolute; bottom:10px; right:10px; z-index:100;" onclick="enterFullGame()">‚õ∂ Fullscreen</button>
                <iframe id="game-frame" src="" allow="gamepad *; keyboard-lock *;"></iframe>
            </div>
        </div>

        <div id="chatterbox" class="section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h2>ChatterBox</h2>
                <button class="btn" onclick="toggleFullscreenEl('chatterbox')">‚õ∂ Fullscreen</button>
            </div>
            <iframe src="https://whatever-works123.github.io/Chatter-Box/" style="height:500px;"></iframe>
        </div>

        <div id="settings" class="section">
            <h2>System Settings</h2>
            <div class="dashboard-grid">
                <div class="card" style="grid-column: span 2;">
                    <h3>üìÖ Edit Class Schedule</h3>
                    <div class="schedule-grid" style="margin-top:15px;">
                        <div class="schedule-col red-day">
                            <h4>üü• Red Day</h4>
                            <input class="class-input" id="set-r1" placeholder="R1 Class">
                            <input class="class-input" id="set-r2" placeholder="R2 Class">
                            <input class="class-input" id="set-r3" placeholder="R3 Class">
                            <input class="class-input" id="set-r4" placeholder="R4 Class">
                        </div>
                        <div class="schedule-col green-day">
                            <h4>üü© Green Day</h4>
                            <input class="class-input" id="set-g5" placeholder="G5 Class">
                            <input class="class-input" id="set-g6" placeholder="G6 Class">
                            <input class="class-input" id="set-g7" placeholder="G7 Class">
                            <input class="class-input" id="set-g8" placeholder="G8 Class">
                        </div>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-primary" onclick="saveSettingsSchedule()">Update Schedule</button>
                        <button class="btn" onclick="manualSwapDay()" style="border:1px solid var(--border);">Force Swap Today's Color</button>
                    </div>
                </div>

                <div class="card">
                    <h3>üîí Stealth Mode</h3>
                    <p style="color:var(--text-secondary); margin-bottom:15px;">Instantly switch between School and Secret modes.</p>
                    <button class="btn btn-primary" onclick="toggleMode()">Switch Mode</button>
                    <p style="font-size:0.8rem; margin-top:10px; color:var(--text-secondary);">Shortcut: Press <strong>ESC</strong> key</p>
                </div>
                <div class="card">
                    <h3>üé® Appearance</h3>
                    <p style="color:var(--text-secondary); margin-bottom:15px;">Switch between Light and Dark interface.</p>
                    <button class="btn" onclick="toggleTheme()">Toggle Theme</button>
                </div>
            </div>
        </div>
    </main>

    <textarea id="drive-mad-code" style="display:none;">
<!DOCTYPE html><html lang="en"><head><base href="https://cdn.jsdelivr.net/gh/genizy/dmad-poki@49b5ab6b987f5f3be58f9dae59c92e8fc1aab9b0/"><script>window.assgdd={"ancestorOrigins":{"0":"https://games.poki.com","1":"https://poki.com"},"href":"https://f9564e4e-ef25-4e4b-ba67-cb11a1576bbd.poki-gdn.com/cc1bc57a-e355-4696-97c2-097bf6188606/index.html?cloudsavegames=y"}</script><meta charset="utf-8"><title>Drive Mad</title><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><link rel="stylesheet" href="webapp/fancade.css"><script src="poki-sdk.js"></script></head><body id="body"><div id="canvas_border" class="emscripten_border"><div id="play_content" class="middle center"><div class="edge"><div class="box"><div class="black"><img src="webapp/cover.jpg" class="cover"><p class="title">Drive Mad</p></div></div></div><div id="progress_or_play"><progress id="progress" class="loading" value="0" max="100"></progress></div></div><canvas class="emscripten" id="canvas" tabindex=-1></canvas></div><script type="text/javascript" src="webapp/source_min.js"></script><script type="text/javascript" src="webapp/index.js"></script></body></html>
    </textarea>
    <textarea id="geo-dash-code" style="display:none;">
<!DOCTYPE html><html lang="en-US"><head><base href="https://rawcdn.githack.com/genizy/google-class/main/gdlite/"><title>Geometry Dash</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="themes/geometrydashlite.io/rs/css/home.css?v=1"></head><body style="margin:0;overflow:hidden;background:#000;"><div id="gameContainer" style="width:100vw;height:100vh;"></div><script src="Build/UnityLoader.js"></script><script>var gameInstance=UnityLoader.instantiate("gameContainer","Build/GeometryDashLite.json");</script></body></html>
    </textarea>

    <script>
        // --- LOCAL STORAGE MANAGER (OFFLINE DB) ---
        let currentUser = null;
        let globalSchedule = {};
        
        const hour = new Date().getHours();
        document.getElementById('greeting').innerText = hour < 12 ? 'Good Morning.' : hour < 18 ? 'Good Afternoon.' : 'Good Evening.';

        // --- AUTH SYSTEM ---
        
        // Check if user is already logged in
        function checkSession() {
            const storedUser = localStorage.getItem('studyhall_session');
            if(storedUser) {
                currentUser = JSON.parse(storedUser);
                onLoginSuccess();
            } else {
                document.getElementById('login-overlay').style.display = 'flex';
            }
        }

        function registerUser() {
            const user = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            const err = document.getElementById('login-error');

            if(!user || !pass) { err.innerText = "Please enter username and password."; return; }
            
            // Check if user exists
            const existing = localStorage.getItem('user_' + user);
            if(existing) { err.innerText = "User already exists."; return; }

            // Create User
            const userData = { username: user, password: pass, uid: 'user_' + user };
            localStorage.setItem('user_' + user, JSON.stringify(userData));
            
            // Auto Login
            loginLogic(user, pass);
        }

        function loginUser() {
            const user = document.getElementById('email').value;
            const pass = document.getElementById('password').value;
            loginLogic(user, pass);
        }

        function loginLogic(user, pass) {
            const err = document.getElementById('login-error');
            const data = localStorage.getItem('user_' + user);
            
            if(!data) { err.innerText = "User not found."; return; }
            
            const parsed = JSON.parse(data);
            if(parsed.password === pass) {
                currentUser = parsed;
                localStorage.setItem('studyhall_session', JSON.stringify(currentUser));
                onLoginSuccess();
            } else {
                err.innerText = "Incorrect password.";
            }
        }

        function logoutUser() {
            localStorage.removeItem('studyhall_session');
            location.reload();
        }

        function onLoginSuccess() {
            document.getElementById('login-overlay').style.display = 'none';
            document.getElementById('user-display').innerText = currentUser.username;
            
            loadUserData();
            loadPosts();
            
            // Check Schedule
            const sched = getDB('schedule');
            if(!sched) {
                document.getElementById('setup-overlay').style.display = 'flex';
            } else {
                globalSchedule = sched;
                updateDayCycle();
                fillSettingsInputs(sched);
            }
        }

        // --- DB HELPERS ---
        function getDB(key) {
            return JSON.parse(localStorage.getItem(currentUser.uid + '_' + key));
        }
        function setDB(key, val) {
            localStorage.setItem(currentUser.uid + '_' + key, JSON.stringify(val));
        }

        // --- DATA LOADERS ---
        function loadUserData() {
            ['math', 'science', 'ela', 'history'].forEach(sub => {
                const note = getDB(sub);
                if(note) {
                    document.getElementById('note-' + sub).value = note;
                    if(sub === 'ela' || sub === 'history') countWords('note-'+sub, sub==='ela'?'ela-count':'hist-count');
                }
            });
            const todos = getDB('todos');
            if(todos) { todoArray = todos; renderTodos(); }
        }
        
        function saveData(subject) {
            setDB(subject, document.getElementById('note-' + subject).value);
            toast();
        }

        // --- SCHEDULE LOGIC ---
        function updateDayCycle() {
            const override = localStorage.getItem('dayCycleOverride');
            let isGreen = override ? JSON.parse(override).isGreen : calculateAutoDay();
            renderDayUI(isGreen);
        }

        function calculateAutoDay() {
            const anchor = new Date('2026-01-28T00:00:00'); // Green
            const diff = Math.floor((new Date() - anchor) / (1000 * 60 * 60 * 24));
            return (diff % 2 === 0);
        }

        function manualSwapDay() {
            const banner = document.getElementById('day-banner');
            const isGreen = !banner.classList.contains('day-green');
            localStorage.setItem('dayCycleOverride', JSON.stringify({ isGreen }));
            renderDayUI(isGreen);
            toast("Day Swapped");
        }

        function renderDayUI(isGreen) {
            const banner = document.getElementById('day-banner');
            const list = document.getElementById('sidebar-schedule-list');
            
            banner.className = 'day-indicator ' + (isGreen ? 'day-green' : 'day-red');
            document.getElementById('day-title').innerText = isGreen ? 'Green Day' : 'Red Day';
            
            let html = '';
            if (isGreen) {
                html += `<div class="sched-btn" style="border-left-color:var(--green-day)"><span>G5</span> ${globalSchedule.g5 || 'Free'}</div>`;
                html += `<div class="sched-btn" style="border-left-color:var(--green-day)"><span>G6</span> ${globalSchedule.g6 || 'Free'}</div>`;
                html += `<div class="sched-btn" style="border-left-color:var(--green-day)"><span>G7</span> ${globalSchedule.g7 || 'Free'}</div>`;
                html += `<div class="sched-btn" style="border-left-color:var(--green-day)"><span>G8</span> ${globalSchedule.g8 || 'Free'}</div>`;
            } else {
                html += `<div class="sched-btn" style="border-left-color:var(--red-day)"><span>R1</span> ${globalSchedule.r1 || 'Free'}</div>`;
                html += `<div class="sched-btn" style="border-left-color:var(--red-day)"><span>R2</span> ${globalSchedule.r2 || 'Free'}</div>`;
                html += `<div class="sched-btn" style="border-left-color:var(--red-day)"><span>R3</span> ${globalSchedule.r3 || 'Free'}</div>`;
                html += `<div class="sched-btn" style="border-left-color:var(--red-day)"><span>R4</span> ${globalSchedule.r4 || 'Free'}</div>`;
            }
            list.innerHTML = html;
        }

        function saveInitialSetup() {
            const s = {
                r1: document.getElementById('setup-r1').value,
                r2: document.getElementById('setup-r2').value,
                r3: document.getElementById('setup-r3').value,
                r4: document.getElementById('setup-r4').value,
                g5: document.getElementById('setup-g5').value,
                g6: document.getElementById('setup-g6').value,
                g7: document.getElementById('setup-g7').value,
                g8: document.getElementById('setup-g8').value
            };
            setDB('schedule', s);
            document.getElementById('setup-overlay').style.display = 'none';
            globalSchedule = s;
            updateDayCycle();
            fillSettingsInputs(s);
            toast("Schedule Saved!");
        }

        function saveSettingsSchedule() {
            const s = {
                r1: document.getElementById('set-r1').value,
                r2: document.getElementById('set-r2').value,
                r3: document.getElementById('set-r3').value,
                r4: document.getElementById('set-r4').value,
                g5: document.getElementById('set-g5').value,
                g6: document.getElementById('set-g6').value,
                g7: document.getElementById('set-g7').value,
                g8: document.getElementById('set-g8').value
            };
            setDB('schedule', s);
            globalSchedule = s;
            updateDayCycle();
            toast("Updated!");
        }

        function fillSettingsInputs(s) {
            document.getElementById('set-r1').value = s.r1||''; document.getElementById('set-r2').value = s.r2||'';
            document.getElementById('set-r3').value = s.r3||''; document.getElementById('set-r4').value = s.r4||'';
            document.getElementById('set-g5').value = s.g5||''; document.getElementById('set-g6').value = s.g6||'';
            document.getElementById('set-g7').value = s.g7||''; document.getElementById('set-g8').value = s.g8||'';
        }

        // --- TODOS ---
        function addTodo() { const t = document.getElementById('newTodo').value; if(t){ todoArray.push({text:t, done:false}); updateTodoDB(); document.getElementById('newTodo').value=''; } }
        function toggleTodo(i) { todoArray[i].done = !todoArray[i].done; updateTodoDB(); }
        function removeTodo(i) { todoArray.splice(i,1); updateTodoDB(); }
        function updateTodoDB() { setDB('todos', todoArray); renderTodos(); }
        function renderTodos() {
            const l = document.getElementById('todoList'), m = document.getElementById('mini-todo-list');
            l.innerHTML=''; m.innerHTML=''; let p=0;
            todoArray.forEach((t,i) => {
                l.innerHTML += `<div class="todo-item ${t.done?'done':''}"><span onclick="toggleTodo(${i})" style="cursor:pointer; flex:1;">${t.text}</span><button class="btn btn-danger" onclick="removeTodo(${i})" style="padding:4px 8px; font-size:0.8rem;">√ó</button></div>`;
                if(!t.done){ p++; if(p<=3) m.innerHTML+=`<li>‚Ä¢ ${t.text}</li>`; }
            });
            if(p===0) m.innerHTML='<li style="color:var(--text-secondary);">No pending tasks.</li>';
        }

        // --- SOCIAL (LOCAL SIMULATION) ---
        function createInstaPost() {
            const cap = document.getElementById('post-caption-input').value;
            const img = document.getElementById('post-img-url').value;
            if(!cap && !img) return;
            
            const post = { username: currentUser.username, caption: cap, image: img, likes: 0, id: Date.now() };
            const posts = JSON.parse(localStorage.getItem('local_posts') || '[]');
            posts.push(post);
            localStorage.setItem('local_posts', JSON.stringify(posts));
            
            toast("Shared!");
            document.getElementById('new-post-area').style.display='none';
            loadPosts();
        }

        function loadPosts() {
            const feed = document.getElementById('feed-container');
            const localPosts = JSON.parse(localStorage.getItem('local_posts') || '[]');
            
            // Add some "Fake" posts so it's not empty
            const fakePosts = [
                { username: "SchoolAdmin", caption: "Reminder: Early release tomorrow for teacher planning.", likes: 45, id: 1 },
                { username: "StudyBot", caption: "Tip: Use the Pomodoro timer to stay focused!", likes: 120, id: 2 }
            ];
            
            const allPosts = [...localPosts, ...fakePosts].reverse();
            feed.innerHTML = '';
            
            if(currentUser) document.getElementById('nav-user-pic').innerText = currentUser.username.charAt(0).toUpperCase();

            allPosts.forEach(p => {
                const liked = localStorage.getItem(`liked_${p.id}`) === 'true';
                const heart = liked ? 'fas fa-heart liked' : 'far fa-heart';
                const imgHTML = p.image ? `<img class="insta-post-img" src="${p.image}">` : '';
                
                feed.innerHTML += `
                <div class="insta-post-card">
                    <div class="insta-post-header">
                        <div class="insta-user-details">
                            <div class="insta-profile-pic"><div>${p.username.charAt(0)}</div></div>
                            <h3>${p.username}</h3>
                        </div>
                    </div>
                    ${imgHTML}
                    <div class="insta-post-footer">
                        <div class="insta-actions">
                            <div class="insta-action-left">
                                <i class="${heart}" onclick="toggleLike(${p.id}, this)"></i>
                                <i class="far fa-comment"></i>
                            </div>
                        </div>
                        <p class="insta-likes">${p.likes + (liked?1:0)} likes</p>
                        <div class="insta-caption"><b>${p.username}</b> ${p.caption}</div>
                    </div>
                </div>`;
            });
        }

        function toggleLike(id, el) {
            const key = `liked_${id}`;
            const isLiked = localStorage.getItem(key) === 'true';
            localStorage.setItem(key, !isLiked);
            loadPosts(); // Re-render to update count/color
        }

        // --- UTILS ---
        function calc(v) { 
            const d = document.getElementById('calcDisplay'); 
            if(v==='C') d.value=''; else if(v==='=') try{ d.value=eval(d.value.replace(/sin/g,'Math.sin').replace(/cos/g,'Math.cos').replace(/tan/g,'Math.tan').replace(/sqrt/g,'Math.sqrt').replace(/pow/g,'Math.pow').replace(/PI/g,'Math.PI')); }catch{d.value='Error'} else d.value+=v; 
        }
        function toast(m) { const t=document.getElementById('toast'); t.innerText=m||"Saved"; t.style.opacity='1'; setTimeout(()=>t.style.opacity='0',2000); }
        function countWords(id, d) { const t = document.getElementById(id).value.trim(); document.getElementById(d).innerText = (t?t.split(/\s+/).length:0) + " words"; }
        function toggleMode() { document.body.classList.toggle('mode-school'); document.body.classList.toggle('mode-fun'); showSection(document.body.classList.contains('mode-school')?'school-home':'fun-home'); }
        function showSection(id) { document.querySelectorAll('.section').forEach(s=>s.classList.remove('active')); document.getElementById(id).classList.add('active'); document.querySelectorAll('.nav-btn').forEach(b=>b.classList.remove('active')); const b = Array.from(document.querySelectorAll('.nav-btn')).find(x=>x.getAttribute('onclick').includes(id)); if(b) b.classList.add('active'); }
        function toggleTheme() { const b=document.body; b.setAttribute('data-theme', b.getAttribute('data-theme')==='light'?'dark':'light'); }
        
        // Games
        function loadGame(id) { const f=document.getElementById('game-frame'); f.srcdoc=document.getElementById(id).value; }
        function loadDriveMad() { loadGame('drive-mad-code'); } function loadGeoDash() { loadGame('geo-dash-code'); }
        function toggleFullscreenEl(id) { const e=document.getElementById(id); e.classList.toggle('fullscreen-mode'); }
        function enterFullGame() { document.getElementById('game-container').classList.add('fullscreen-mode'); document.getElementById('exit-game-fs').style.display='block'; }
        function exitFullGame() { document.getElementById('game-container').classList.remove('fullscreen-mode'); document.getElementById('exit-game-fs').style.display='none'; }
        document.addEventListener('keydown', e=>{ if(e.key==="Escape"){ const f=document.querySelector('.fullscreen-mode'); if(f){ f.classList.remove('fullscreen-mode'); if(f.id==='game-container') document.getElementById('exit-game-fs').style.display='none'; } else if(document.body.classList.contains('mode-fun')) toggleMode(); } });

        // Periodic Table
        const ptElements=[{num:1,sym:"H"},{num:2,sym:"He"},{num:3,sym:"Li"},{num:4,sym:"Be"},{num:5,sym:"B"},{num:6,sym:"C"},{num:7,sym:"N"},{num:8,sym:"O"},{num:9,sym:"F"},{num:10,sym:"Ne"},{num:11,sym:"Na"},{num:12,sym:"Mg"},{num:13,sym:"Al"},{num:14,sym:"Si"},{num:15,sym:"P"},{num:16,sym:"S"},{num:17,sym:"Cl"},{num:18,sym:"Ar"}];
        const table = document.getElementById('table'); 
        ptElements.forEach(e=>{ const d=document.createElement('div'); d.className='element cat-unknown'; d.innerHTML=`<div class="num">${e.num}</div><div class="sym">${e.sym}</div>`; table.appendChild(d); });

        // Timer
        let tInt=null, tLeft=1500;
        function toggleTimer() { const ui=document.getElementById('timer-ui'); if(tInt){ clearInterval(tInt); tInt=null; ui.classList.remove('timer-active'); } else { ui.classList.add('timer-active'); tInt=setInterval(()=>{ if(tLeft>0){ tLeft--; let m=Math.floor(tLeft/60).toString().padStart(2,'0'), s=(tLeft%60).toString().padStart(2,'0'); document.getElementById('timer-display').innerText=`${m}:${s}`; }else{ clearInterval(tInt); alert("Time!"); } },1000); } }
        function resetTimer() { clearInterval(tInt); tInt=null; tLeft=1500; document.getElementById('timer-display').innerText="25:00"; document.getElementById('timer-ui').classList.remove('timer-active'); }

        // Start
        checkSession();
    </script>
</body>
</html>
